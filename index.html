<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>JEE Mains — NTA-style Mock Test (Embedded Questions)</title>
<style>
  :root{
    --nta-orange:#f97316;
    --bg:#f3f4f6;
    --card:#ffffff;
    --muted:#6b7280;
    --accent:#0b63d6;
    --green:#10b981;
    --red:#ef4444;
    --shadow: 0 8px 24px rgba(15,23,42,0.06);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;color:#111;background:var(--bg);-webkit-font-smoothing:antialiased}
  header{background:linear-gradient(90deg,var(--nta-orange),#ff8a3d);color:#fff;padding:12px 18px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
  .brand{display:flex;align-items:center;gap:12px}
  .brand h1{font-size:18px;margin:0;font-weight:700}
  .top-info{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .chip{background:rgba(255,255,255,0.12);padding:7px 10px;border-radius:8px;font-size:14px}
  .container{max-width:1200px;margin:18px auto;padding:12px}
  .exam-grid{display:grid;grid-template-columns:1fr 360px;gap:16px}
  .left,.right{background:var(--card);padding:14px;border-radius:10px;box-shadow:var(--shadow)}
  .left{min-height:680px;display:flex;flex-direction:column}
  .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:12px}
  .tabs{display:flex;gap:8px;flex-wrap:wrap}
  .tab{background:#fff;border:1px solid #e6e7ee;padding:8px 12px;border-radius:6px;cursor:pointer;font-weight:600}
  .tab.active{background:rgba(255,255,255,0.14);color:#fff;border-color:transparent;box-shadow:inset 0 -2px 0 rgba(255,255,255,0.06)}
  .question-area{flex:1;overflow:auto;padding:12px;border-radius:8px;background:linear-gradient(180deg,#fff,#fafafa);border:1px solid #eef2f7}
  .qmeta{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .qno{font-weight:700}
  .qtext{margin-bottom:12px;line-height:1.5}
  .options{display:flex;flex-direction:column;gap:10px}
  .option{display:flex;gap:12px;align-items:flex-start;padding:12px;border-radius:10px;border:1px solid #eef2f7;cursor:pointer;background:#fff;transition:all .15s}
  .option:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(15,23,42,0.04)}
  .option.selected{border-color:var(--nta-orange);background:linear-gradient(180deg,#fff8f0,#fffefb)}
  .controls{display:flex;justify-content:space-between;gap:10px;margin-top:12px;align-items:center}
  .controls .left-controls{display:flex;gap:8px;flex-wrap:wrap}
  button.btn{padding:10px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
  .btn.primary{background:var(--nta-orange);color:#fff}
  .btn.ghost{background:#fff;border:1px solid #e6e7ee;color:var(--muted)}
  .btn.warn{background:#fff6ed;border:1px solid #ffd7a6;color:#92400e}
  .small{font-size:13px;color:var(--muted)}
  .right .palette-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:12px}
  .pal-btn{padding:10px;border-radius:6px;border:1px solid #e6e7ee;background:#fff;cursor:pointer;text-align:center;font-weight:700}
  .pal-btn.notvisited{background:#fff}
  .pal-btn.answered{background:#ecfccb;border-color:#bbf7d0}
  .pal-btn.review{background:#fff7ed;border-color:#ffd1a4}
  .pal-legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .legend-item{display:flex;gap:6px;align-items:center;font-size:13px}
  .legend-box{width:14px;height:14px;border-radius:3px}
  .section-summary{margin-top:12px;font-size:13px;color:var(--muted)}
  .footer-note{font-size:13px;color:var(--muted);text-align:center;margin-top:14px}
  @media(max-width:1050px){.exam-grid{grid-template-columns:1fr}.right{order:2}.left{order:1}header{flex-direction:column;align-items:flex-start}}
</style>
</head>
<body>
<header>
  <div class="brand">
    <svg width="44" height="44" viewBox="0 0 24 24" fill="none" style="background:#fff;border-radius:8px;padding:6px">
      <path d="M3 12h18" stroke="#f97316" stroke-width="2" stroke-linecap="round"/>
      <path d="M12 3v18" stroke="#f97316" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <div>
      <h1>JEE Mains — Mock Test (NTA-style)</h1>
      <div style="font-size:13px;opacity:0.95">Full-length mock — 25 Q per subject</div>
    </div>
  </div>

  <div class="top-info">
    <div class="chip">Name: <strong id="candName">Guest</strong></div>
    <div class="chip">Test: <strong id="testTitle">Custom Mock</strong></div>
    <div class="chip">Time Left: <strong id="timer">03:00:00</strong></div>
  </div>
</header>

<div class="container">
  <div class="exam-grid">
    <div class="left">
      <div class="topbar">
        <div class="tabs" id="sectionTabs"></div>
        <div class="small">Question <span id="qIndex">1</span>/<span id="qTotal">75</span></div>
      </div>

      <div class="question-area" id="questionArea" role="region" aria-live="polite">
        <!-- injected question -->
      </div>

      <div class="controls">
        <div class="left-controls">
          <button class="btn ghost" id="clearBtn">Clear Response</button>
          <button class="btn warn" id="markBtn">Mark for Review & Next</button>
        </div>
        <div>
          <button class="btn ghost" id="prevBtn">Previous</button>
          <button class="btn primary" id="saveNextBtn">Save & Next</button>
          <button class="btn primary" id="submitBtn">Submit</button>
        </div>
      </div>
    </div>

    <div class="right">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <div><strong>Question Palette</strong></div>
        <div class="small">Auto-save: <strong id="autoSave">ON</strong></div>
      </div>

      <div id="palette" class="palette-grid"></div>

      <div class="pal-legend">
        <div class="legend-item"><div class="legend-box" style="background:#fff;border:1px solid #e6e7ee"></div>Not Visited</div>
        <div class="legend-item"><div class="legend-box" style="background:#ecfccb"></div>Answered</div>
        <div class="legend-item"><div class="legend-box" style="background:#fff7ed"></div>Marked for Review</div>
      </div>

      <div class="section-summary">
        <strong>Sections</strong>
        <ul id="sectionSummary" style="padding-left:18px;margin-top:8px"></ul>
      </div>

      <div class="footer-note">Use the palette to jump to any question. Your answers are saved locally.</div>
    </div>
  </div>
</div>

<script>
/* ===========
   Mock Test App
   =========== */

/* Configuration: questions embedded here */
const config = {
  candidateName: "Guest User",
  testTitle: "Custom Mock — Selected Chapters",
  totalDurationMin: 180,
  sections: [
    {
      id: "physics",
      title: "Physics",
      questions: [
        {id:"p1", type:"mcq", text:"Units of stress are same as which of the following?", options:["Energy/volume","Force/area","Force × distance","Momentum/time"], answer:1},
        {id:"p2", type:"mcq", text:"If in dimensional formula of a quantity X, mass exponent is 1, length exponent is 2 and time exponent is −3, then X could be which of the following?", options:["Viscosity","Surface tension","Young's modulus","Coefficient of viscosity"], answer:2},
        {id:"p3", type:"numeric", text:"A body travels with constant acceleration 2 m/s² from rest. Distance covered in 5 s is (in meters).", answer:25},
        {id:"p4", type:"mcq", text:"A particle moves in a circle of radius r with constant speed v. The magnitude of centripetal acceleration is", options:["v/r","v²/r","rv²","r/v"], answer:1},
        {id:"p5", type:"mcq", text:"Which of the following quantities is NOT a vector?", options:["Displacement","Acceleration","Speed","Momentum"], answer:2},
        {id:"p6", type:"numeric", text:"A car starts from rest and after 10 s reaches a velocity of 20 m/s under constant acceleration. What is the acceleration (m/s²)?", answer:2},
        {id:"p7", type:"mcq", text:"If two vectors are perpendicular, their dot product is", options:["Zero","One","Equal to product of magnitudes","Undefined"], answer:0},
        {id:"p8", type:"mcq", text:"A ball is thrown vertically upwards with speed u. Time to return to the thrower is", options:["u/g","2u/g","u/2g","g/u"], answer:1},
        {id:"p9", type:"numeric", text:"A particle moving along x-axis has displacement s = t³ − 6t² + 9t (in m) where t in s. What is velocity at t = 3 s?", answer:0},
        {id:"p10", type:"mcq", text:"Newton's third law implies", options:["Every action has equal and opposite reaction","Momentum is conserved","Work done is zero","Energy is conserved"], answer:0},
        {id:"p11", type:"mcq", text:"Two blocks of masses m and 2m are connected over a frictionless pulley. The acceleration of the system is (g/3). Choose correct mass ratio that gives this acceleration.", options:["m and 2m","m and 3m","2m and 3m","m and 4m"], answer:0},
        {id:"p12", type:"numeric", text:"A horizontal force of 50 N acts on a box of mass 10 kg on a rough floor. If frictional force is 30 N, find acceleration of box (m/s²).", answer:2},
        {id:"p13", type:"mcq", text:"Coefficient of friction is ratio of", options:["Frictional force/normal force","Normal force/weight","Frictional force/weight","Frictional force×normal force"], answer:0},
        {id:"p14", type:"numeric", text:"A block of mass 5 kg is pulled with force 20 N on a horizontal surface. If coefficient of kinetic friction is 0.2, what is acceleration (m/s²)? (g=9.8)", answer: (20-0.2*5*9.8)/5},
        {id:"p15", type:"mcq", text:"Which relation between displacement (s), acceleration (a) and velocity (v) is correct for constant acceleration?", options:["v² = u² + 2as","s = ut + 1/2 at²","v = u + at","All of the above"], answer:3},
        {id:"p16", type:"mcq", text:"A body of mass m resting on a rough inclined plane of angle θ will start sliding when coefficient of static friction μs is", options:["> tanθ","< tanθ","=tanθ","=cosθ"], answer:2},
        {id:"p17", type:"numeric", text:"A particle moves with equation x=4t−t² (x in m, t in s). What is acceleration at t=2 s?", answer:-2},
        {id:"p18", type:"mcq", text:"Dimensions of impulse are same as", options:["Force × time","Mass × acceleration","Energy","Power"], answer:0},
        {id:"p19", type:"mcq", text:"If a car moves with uniform circular motion, which of the following is true?", options:["Speed is constant, acceleration zero","Velocity is constant, acceleration non-zero","Speed constant, acceleration towards center","No acceleration"], answer:2},
        {id:"p20", type:"numeric", text:"If g = 9.8 m/s², the period of small oscillation of a simple pendulum of length 0.98 m (in s) is (use T=2π√(l/g)). Round to two decimals.", answer:2.00},
        {id:"p21", type:"mcq", text:"If the dimensions of a physical quantity are ML²T⁻², it represents", options:["Energy","Force","Pressure","Power"], answer:0},
        {id:"p22", type:"numeric", text:"A particle covered 30 m in first 3 s and then 70 m in next 7 s. Average speed over 10 s is (m/s).", answer:10},
        {id:"p23", type:"mcq", text:"Which of the following is scalar quantity?", options:["Torque","Work","Moment of force","Angular momentum"], answer:1},
        {id:"p24", type:"mcq", text:"If acceleration is proportional to displacement x as a = −ω² x, motion is", options:["Simple harmonic","Uniform","Exponential","None"], answer:0},
        {id:"p25", type:"numeric", text:"A body moving in straight line has velocity v = 6t − t² (m/s). What is displacement between t=0 and t=6 s?", answer:36}
      ]
    },
    {
      id: "chemistry",
      title: "Chemistry",
      questions: [
        {id:"c1", type:"numeric", text:"How many moles are there in 44 g of CO2? (Molar mass CO2 = 44 g/mol)", answer:1},
        {id:"c2", type:"mcq", text:"Avogadro number is approximately", options:["6.02×10²³","3.01×10²³","1.66×10⁻²⁴","9.65×10⁴"], answer:0},
        {id:"c3", type:"mcq", text:"1 mole of ideal gas at STP occupies", options:["22.4 L","24 L","20 L","18 L"], answer:0},
        {id:"c4", type:"numeric", text:"If 0.5 mol H2 reacts with 0.25 mol O2, how many moles of H2O are formed (assuming limiting reagent)?", answer:0.5},
        {id:"c5", type:"mcq", text:"The Rutherford model could not explain", options:["Scattering","Discrete spectral lines","Nucleus discovery","Most alpha scattering"], answer:1},
        {id:"c6", type:"mcq", text:"Principal quantum number n indicates", options:["Energy level","Orbital shape","Spin","Magnetic orientation"], answer:0},
        {id:"c7", type:"numeric", text:"Bohr radius is approximately (in Å).", answer:0.529},
        {id:"c8", type:"mcq", text:"Which element has highest first ionization energy in a period?", options:["Noble gas","Alkali metal","Halogen","Alkaline earth"], answer:0},
        {id:"c9", type:"mcq", text:"Periodic trend: atomic radius increases", options:["Down a group","Across a period left to right","Both","None"], answer:0},
        {id:"c10", type:"numeric", text:"How many atoms are there in 2 moles of NaCl (formula units)? (Use NA=6.02×10²³) Give answer in 10^23 units (approx).", answer:12.04},
        {id:"c11", type:"mcq", text:"Oxidation number of Mn in KMnO4 is", options:["+7","+6","+5","+4"], answer:0},
        {id:"c12", type:"numeric", text:"In redox reaction, if 2 electrons are transferred per molecule and 1 mole reacts, how many moles of electrons are transferred?", answer:2},
        {id:"c13", type:"mcq", text:"Which species is reduced in the reaction O2 + 4H⁺ + 4e⁻ → 2H2O?", options:["O2","H⁺","H2O","e⁻"], answer:0},
        {id:"c14", type:"mcq", text:"Effective nuclear charge experienced by an electron generally", options:["Increases across period","Decreases across period","Increases down group","Remains same"], answer:0},
        {id:"c15", type:"numeric", text:"1.5 mol of electrons corresponds to how many coulombs? (Faraday = 96485 C/mol). Answer approx rounded to nearest integer.", answer:144728},
        {id:"c16", type:"mcq", text:"Which is NOT isoelectronic with Ne?", options:["Na⁺","F⁻","O²⁻","Mg²⁺"], answer:0},
        {id:"c17", type:"numeric", text:"If 10 g of a substance with molar mass 50 g/mol is present, number of moles is", answer:0.2},
        {id:"c18", type:"mcq", text:"Which orbital has angular node count equal to 1?", options:["p","s","d","f"], answer:0},
        {id:"c19", type:"mcq", text:"Which element shows maximum metallic character?", options:["Cs","F","O","N"], answer:0},
        {id:"c20", type:"numeric", text:"Find oxidation state of S in H2SO4.", answer:6},
        {id:"c21", type:"mcq", text:"In redox titration, indicator is used to detect", options:["End point","Equivalence point","Both","None"], answer:0},
        {id:"c22", type:"numeric", text:"Moles of electrons required to reduce 1 mole of Cu²⁺ to Cu metal is", answer:2},
        {id:"c23", type:"mcq", text:"Which has highest electron affinity?", options:["Cl","Na","K","Ar"], answer:0},
        {id:"c24", type:"mcq", text:"Which is a correct electronic configuration for ground state of O atom?", options:["1s2 2s2 2p4","1s2 2s2 2p6","1s2 2s2 2p3","1s2 2s2 2p5"], answer:0},
        {id:"c25", type:"numeric", text:"If 3 moles of H2 react with excess O2, how many moles of H2O produced? (2H2 + O2 → 2H2O)", answer:3}
      ]
    },
    {
      id: "maths",
      title: "Mathematics",
      questions: [
        {id:"m1", type:"mcq", text:"If A = {1,2,3} and B = {2,3,4}, A∪B equals", options:["{1,2,3,4}","{2,3}","{1}","{1,4}"], answer:0},
        {id:"m2", type:"mcq", text:"If f(x)=x²−1, f(2) equals", options:["3","4","1","0"], answer:0},
        {id:"m3", type:"numeric", text:"Solve for x: x² − 5x + 6 = 0. Sum of roots is", answer:5},
        {id:"m4", type:"mcq", text:"sin²θ + cos²θ equals", options:["1","0","sin2θ","cos2θ"], answer:0},
        {id:"m5", type:"numeric", text:"If a GP has first term 2 and common ratio 3, the 4th term is", answer:54},
        {id:"m6", type:"mcq", text:"Which of the following is a function?", options:["x→±√x","x→x²","x→both  √x and −√x","none"], answer:1},
        {id:"m7", type:"mcq", text:"If roots of ax²+bx+c=0 are real and equal, discriminant Δ equals", options:["0",">0","<0","none"], answer:0},
        {id:"m8", type:"numeric", text:"If arithmetic sequence has first term 5 and common difference 3, 10th term is", answer:32},
        {id:"m9", type:"mcq", text:"tan(45°+θ) formula involves", options:["(1+tanθ)/(1−tanθ)","(tanθ−1)/(tanθ+1)","tanθ","secθ"], answer:0},
        {id:"m10", type:"numeric", text:"If f(x)=2x+3 and g(x)=x−1, compute (f∘g)(2).", answer:5},
        {id:"m11", type:"mcq", text:"Set A×B is", options:["Cartesian product","Union","Intersection","Difference"], answer:0},
        {id:"m12", type:"numeric", text:"Sum to n terms of arithmetic progression with a=2, d=5 is (in terms of n): S_n =", answer: "n/2*(2+5*(n-1))+0" },
        {id:"m13", type:"mcq", text:"sinθ = 3/5 in first quadrant. cosθ equals", options:["4/5","-4/5","3/5","-3/5"], answer:0},
        {id:"m14", type:"mcq", text:"If sequence defined by a_n = 1/n, limit as n→∞ is", options:["0","1","∞","does not exist"], answer:0},
        {id:"m15", type:"numeric", text:"If quadratic x² − 4x + 3 = 0, product of roots is", answer:3},
        {id:"m16", type:"mcq", text:"Domain of f(x)=√(x-2) is", options:["x≥2","x>2","x≤2","all real"], answer:0},
        {id:"m17", type:"numeric", text:"Sum of first 6 natural numbers is", answer:21},
        {id:"m18", type:"mcq", text:"If sinA = 1/2 and A in first quadrant, A equals", options:["30°","45°","60°","90°"], answer:0},
        {id:"m19", type:"mcq", text:"If f(x)=x³ is one-to-one?", options:["Yes","No","Only on R+","Only on R-"], answer:0},
        {id:"m20", type:"numeric", text:"Geometric mean of 2 and 8 is", answer:4},
        {id:"m21", type:"mcq", text:"Discriminant of x²+2x+5 is", options:["−16","16","−4","4"], answer:0},
        {id:"m22", type:"numeric", text:"If cosθ = 0.6, sinθ (positive) equals (to two decimals)", answer:0.80},
        {id:"m23", type:"mcq", text:"If A={1,2} and B={3,4}, number of relations from A to B is", options:["2^4","3^2","4^2","2^3"], answer:0},
        {id:"m24", type:"numeric", text:"Sum of infinite GP with first term 8 and ratio 1/4 is", answer: (8/(1-0.25))},
        {id:"m25", type:"mcq", text:"Quadratic x² − 2x + 1 factors to", options:["(x−1)²","(x+1)²","x(x−2)+1","none"], answer:0}
      ]
    }
  ]
};

/* State */
const state = {
  currentSectionIndex: 0,
  currentQuestionIndex: 0,
  answers: {},
  startTime: null,
  durationSec: config.totalDurationMin * 60,
  timerInterval: null
};

const $ = s => document.querySelector(s);
const formatTime = sec => {
  if(sec<0) sec=0;
  const h=Math.floor(sec/3600), m=Math.floor((sec%3600)/60), s=sec%60;
  return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
};

function init(){
  $('#candName').innerText = config.candidateName;
  $('#testTitle').innerText = config.testTitle;
  $('#qTotal').innerText = config.sections.reduce((acc,s)=>acc+s.questions.length,0);
  buildSectionTabs();
  loadState();
  renderQuestion();
  buildPalette();
  updateSectionSummary();
  startTimer();
  $('#saveNextBtn').addEventListener('click', ()=>{ saveAnswer(); gotoNext(); });
  $('#prevBtn').addEventListener('click', ()=>{ saveAnswer(); gotoPrev(); });
  $('#clearBtn').addEventListener('click', clearResponse);
  $('#markBtn').addEventListener('click', ()=>{ markForReviewAndNext(); });
  $('#submitBtn').addEventListener('click', submitPaper);
  window.addEventListener('beforeunload', saveState);
}

function buildSectionTabs(){
  const el = $('#sectionTabs'); el.innerHTML='';
  config.sections.forEach((s,i)=>{
    const b = document.createElement('button');
    b.className = 'tab' + (i===state.currentSectionIndex? ' active':'');
    b.innerText = s.title;
    b.addEventListener('click', ()=>{ state.currentSectionIndex=i; state.currentQuestionIndex=0; updateAfterNavigation(); buildSectionTabs(); });
    el.appendChild(b);
  });
}

function renderQuestion(){
  const sec = config.sections[state.currentSectionIndex];
  const q = sec.questions[state.currentQuestionIndex];
  $('#qIndex').innerText = getGlobalQuestionNumber();
  const area = $('#questionArea'); area.innerHTML='';
  const meta = document.createElement('div'); meta.className='qmeta';
  meta.innerHTML = `<div class="qno">${sec.title} — Q${state.currentQuestionIndex+1}</div><div class="small">Subject: ${sec.title}</div>`;
  const qtext = document.createElement('div'); qtext.className='qtext'; qtext.innerHTML = q.text;
  const opts = document.createElement('div'); opts.className='options';
  if(q.type==='mcq'){
    q.options.forEach((opt, idx)=>{
      const o = document.createElement('div'); o.className='option'; o.tabIndex=0;
      o.innerHTML = `<div style="min-width:28px"><strong>${String.fromCharCode(65+idx)}</strong></div><div style="flex:1">${opt}</div>`;
      o.addEventListener('click', ()=>{ selectOption(q.id, idx); });
      o.addEventListener('keydown', (e)=>{ if(e.key==='Enter') selectOption(q.id, idx); });
      opts.appendChild(o);
    });
  } else {
    const input = document.createElement('input'); input.type='text'; input.placeholder='Numeric answer'; input.style.padding='10px'; input.style.border='1px solid #e6e7ee'; input.style.borderRadius='6px'; input.style.width='100%';
    input.addEventListener('input', ()=>{ state.answers[q.id] = state.answers[q.id]||{}; state.answers[q.id].value = input.value; saveState(); updatePaletteButton(q.id); updateSectionSummary(); });
    opts.appendChild(input);
    const prev = state.answers[q.id] && state.answers[q.id].value; if(prev) input.value = prev;
  }
  area.appendChild(meta); area.appendChild(qtext); area.appendChild(opts);
  reflectSelection(q);
}

function getGlobalQuestionNumber(){
  let n=0;
  for(let i=0;i<state.currentSectionIndex;i++) n+=config.sections[i].questions.length;
  return n + state.currentQuestionIndex + 1;
}

function selectOption(qid, idx){
  state.answers[qid] = state.answers[qid]||{};
  state.answers[qid].value = idx;
  state.answers[qid].marked = false;
  saveState();
  reflectSelectionById(qid);
  updatePaletteButton(qid);
  updateSectionSummary();
}
function reflectSelection(q){
  if(q.type!=='mcq') return;
  const nodes = document.querySelectorAll('.option');
  nodes.forEach((node, idx)=>{
    node.classList.remove('selected');
    const stored = state.answers[q.id] && state.answers[q.id].value;
    if(stored!==undefined && parseInt(stored)===idx) node.classList.add('selected');
  });
}
function reflectSelectionById(qid){
  const sec = config.sections[state.currentSectionIndex];
  const q = sec.questions[state.currentQuestionIndex];
  if(q.id===qid) reflectSelection(q);
}

function gotoNext(){
  const sec=config.sections[state.currentSectionIndex];
  if(state.currentQuestionIndex < sec.questions.length-1){ state.currentQuestionIndex++; renderQuestion(); }
  else if(state.currentSectionIndex < config.sections.length-1){ state.currentSectionIndex++; state.currentQuestionIndex=0; buildSectionTabs(); renderQuestion(); buildPalette(); }
  else{ alert('This is the last question'); }
}
function gotoPrev(){
  if(state.currentQuestionIndex>0){ state.currentQuestionIndex--; renderQuestion(); }
  else if(state.currentSectionIndex>0){ state.currentSectionIndex--; const s=config.sections[state.currentSectionIndex]; state.currentQuestionIndex = s.questions.length-1; buildSectionTabs(); renderQuestion(); buildPalette(); }
  else{ alert('This is the first question'); }
}

function clearResponse(){
  const q = getCurrentQuestion();
  if(!q) return;
  delete state.answers[q.id];
  saveState();
  renderQuestion();
  updatePaletteButton(q.id);
  updateSectionSummary();
}
function markForReviewAndNext(){
  const q = getCurrentQuestion();
  if(!q) return;
  state.answers[q.id] = state.answers[q.id] || {};
  state.answers[q.id].marked = true;
  saveState();
  updatePaletteButton(q.id);
  updateSectionSummary();
  gotoNext();
}
function getCurrentQuestion(){ return config.sections[state.currentSectionIndex].questions[state.currentQuestionIndex]; }

function buildPalette(){
  const sec = config.sections[state.currentSectionIndex];
  const pal = $('#palette'); pal.innerHTML='';
  sec.questions.forEach((q, idx)=>{
    const b = document.createElement('button'); b.className='pal-btn notvisited'; b.id = 'pal-'+q.id; b.innerText = idx+1;
    b.addEventListener('click', ()=>{ state.currentQuestionIndex = idx; renderQuestion(); updatePaletteSelection(idx); });
    pal.appendChild(b);
    updatePaletteButton(q.id);
  });
  updatePaletteSelection(state.currentQuestionIndex);
}
function updatePaletteButton(qid){
  const btn = document.getElementById('pal-'+qid);
  if(!btn) return;
  btn.className='pal-btn';
  const entry = state.answers[qid];
  if(!entry) btn.classList.add('notvisited');
  else if(entry.marked) btn.classList.add('review');
  else if(entry.value!==undefined && entry.value!=='') btn.classList.add('answered');
  else btn.classList.add('notvisited');
}
function updatePaletteSelection(idx){ document.querySelectorAll('.pal-btn').forEach((b,i)=>{ b.style.outline = i===idx? '2px solid rgba(0,0,0,0.08)':'none'; }); }

function updateSectionSummary(){
  const ul = $('#sectionSummary'); ul.innerHTML='';
  config.sections.forEach((s,i)=>{
    const answered = s.questions.filter(q=> state.answers[q.id] && state.answers[q.id].value!==undefined ).length;
    const marked = s.questions.filter(q=> state.answers[q.id] && state.answers[q.id].marked).length;
    const li = document.createElement('li'); li.innerText = `${s.title}: ${answered}/${s.questions.length} answered, ${marked} marked`;
    ul.appendChild(li);
  });
}

function startTimer(){
  if(!state.startTime) state.startTime = Date.now();
  const end = state.startTime + state.durationSec*1000;
  state.timerInterval = setInterval(()=>{
    const left = Math.round((end - Date.now())/1000);
    $('#timer').innerText = formatTime(left);
    if(left<=0){ clearInterval(state.timerInterval); autoSubmit(); }
  },500);
}
function autoSubmit(){ alert('Time is up! Auto-submitting...'); submitPaper(true); }

function saveState(){
  try{
    const payload = {state:{answers: state.answers, startTime: state.startTime, currentSectionIndex: state.currentSectionIndex, currentQuestionIndex: state.currentQuestionIndex}};
    localStorage.setItem('jee_mock_state', JSON.stringify(payload));
    $('#autoSave').innerText='ON';
  } catch(e){ $('#autoSave').innerText='OFF'; }
}
function loadState(){
  try{
    const raw = localStorage.getItem('jee_mock_state'); if(!raw) return;
    const payload = JSON.parse(raw);
    if(payload.state){ state.answers = payload.state.answers || {}; state.startTime = payload.state.startTime || Date.now(); state.currentSectionIndex = payload.state.currentSectionIndex||0; state.currentQuestionIndex = payload.state.currentQuestionIndex||0; }
  } catch(e){ console.warn('No saved state'); }
}

function submitPaper(isAuto=false){
  if(!isAuto){ if(!confirm('Submit test? You will not be able to change answers.')) return; }
  let total=0, attempted=0, correct=0; const details=[];
  config.sections.forEach(sec=>{ sec.questions.forEach(q=>{
    total++; const entry = state.answers[q.id];
    if(entry && entry.value!==undefined && entry.value!=='') attempted++;
    let isCorrect=false;
    if(q.type==='mcq'){
      if(entry && parseInt(entry.value) === q.answer) { correct++; isCorrect=true; }
    } else {
      if(entry && entry.value!==undefined){
        const a=parseFloat(entry.value);
        let b;
        if(typeof q.answer === "string"){
          try { b = eval(q.answer); } catch(e){ b = parseFloat(q.answer); }
        } else b = q.answer;
        if(!isNaN(a) && !isNaN(b) && Math.abs(a-b) <= Math.max(0.01, Math.abs(b)*0.001)) { correct++; isCorrect=true; }
      }
    }
    details.push({id:q.id, text:q.text, your:entry?entry.value:null, correct:isCorrect, solution:q.solution||''});
  })});
  const left=document.querySelector('.left'); left.innerHTML='';
  const res=document.createElement('div'); res.style.padding='14px';
  res.innerHTML=`<h2>Result</h2><p class="small">Total: ${total} | Attempted: ${attempted} | Correct: ${correct} | Score: ${correct} (1 mark each)</p>`;
  const det=document.createElement('details'); det.innerHTML='<summary>Detailed</summary><div></div>'; const wrap=det.querySelector('div');
  details.forEach((d,i)=>{ const e=document.createElement('div'); e.style.borderTop='1px dashed #e6e7ee'; e.style.padding='8px 0'; e.innerHTML=`<div><strong>Q${i+1}:</strong> ${d.text}</div><div class="small">Your: ${d.your===null?'<em>Not answered</em>':d.your} | ${d.correct?'<span style="color:green">Correct</span>':'<span style="color:red">Incorrect</span>'}</div><div class="small">Solution: ${d.solution||'No solution provided'}</div>`; wrap.appendChild(e); });
  res.appendChild(det); left.appendChild(res);
  clearInterval(state.timerInterval);
}

function updateAfterNavigation(){ renderQuestion(); buildPalette(); updateSectionSummary(); saveState(); }
init();
</script>
</body>
</html>
